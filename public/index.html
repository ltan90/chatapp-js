<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<link rel="stylesheet" href="css/style.min.css" />
		<title>ChatCord App</title>
	</head>
	<body>
		<section class="chatapp">
            <div id="chatapp-scroll" class="chatapp__panel panel panel-active">
                <div class="panel__header">
                    <div class="panel__header__top">
                        <!--chatapp-visible-->
                        <div class="panel__header__left chatapp-system chatapp-visible">
                            <h4 class="panel__title"></h4>
                            <span class="panel__name"></span>
                        </div>
                        <div class="panel__header__right">
                            <span class="panel__icon panel__icon--arrow chatapp-close-js"></span>
                            <span class="panel__icon panel__icon--close chatapp-session-js"></span>
                        </div>
                    </div>
                    <div class="panel__header__welcome chatapp-logo text-center">
                        <span class="panel__logo">
                            <img src="images/logo_chatapp.svg" alt="logo"/>
                        </span>
                        <h4 class="panel__title panel__title--welcome">Welcome to Live Chat</h4>
                    </div>
                </div>
                <div id="messages" class="panel__body panel__body--login">
                    <div class="chatapp-form chatapp__form">
                        <span class="chatapp__form__hello">Hello! How can we help you?</span>
                        <div class="panel__input panel__input--login chatapp__radius">
                            <form action="" method="post" class="chatapp-login-js">
								<input type="email" name="email" class="panel__input__control" placeholder="Please enter your email..."/>
								<input type="hidden" name="room" class="random-room" value="sales">
                                <button type="submit" class="btn__login text-center">Start Chat Without Login</button>
                                <button class="chatapp__radius btn__login btn__login--signup text-center" >Sign Up or LoginÂ </button>
                            </form>
                        </div>
                    </div>   
                    <div class="chatapp-content-js"></div>                 
                </div>
                <div class="panel__footer footer-active-js">
                    <span class="panel__attach">
                        <label for="file" class="panel__icon panel__icon--attach"></label>
                        <input type="file" name="attach" id="file" class="file" disabled onchange="getFile()"/>
                    </span>
                    <span class="panel__icon panel__icon--cart active-search-js">
                        <div class="chatapp__form chatapp__form--search search-list-js">
                            <input type="text" class="search__input search__radius" id="search-product" placeholder="Search" autocomplete="off"/>
                        </div>
                    </span>
                    <div class="panel__input">
                        <form action="" method="get" name="frm-message" class="chatapp__frm chatapp-message-js">
                            <input id="msg" type="text" name="message" class="panel__input__control" placeholder="Type a message" autocomplete="off" readonly/>
                            <button type="submit" class="btn__chatapp" disabled>
                                <span class="panel__icon panel__icon--send"></span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <span class="chatapp__icon chatapp-close-js chatapp-hidden">
                <span class="chatapp__icon__arrow"></span>
            </span>
        </section>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
		<script src="js/cart.js"></script>
		<script>
			const socket = io('https://chatnode.azurewebsites.net/');
			//if(document.querySelector('.random-room')) document.querySelector('.random-room').value = Math.floor((Math.random() * 1000000000) + 1);
			document.querySelector('.chatapp-login-js').addEventListener('submit', function(e){
				e.preventDefault();
				if(validate(this)){
					document.querySelector('.chatapp-logo').classList.add('chatapp-hidden');
					document.querySelector('.chatapp-form').parentElement.classList.remove('panel__body--login');
					document.querySelector('.chatapp-form').classList.add('chatapp-hidden');
					document.querySelector('.panel__title').innerText = "Live Chat";
					document.querySelector('.panel').classList.add('panel--system');
					document.querySelector('.chatapp-system').classList.remove('chatapp-visible');                    
					document.querySelector('.chatapp-message-js').firstElementChild.removeAttribute('readonly');
					document.querySelector('.chatapp-message-js').firstElementChild.nextElementSibling.removeAttribute('disabled');
					document.querySelector('.file').removeAttribute('disabled');
					document.querySelector('.footer-active-js').firstElementChild.nextElementSibling.classList.add('search-product-js');
					
					//Chat app
					let emailChat = this['email'].value;
					let roomChat = this['room'].value;

					let userChat = users.find(user => user.email === emailChat);

					const chatForm = document.querySelector('.chatapp-message-js');
					const chatMessages = document.getElementById('messages');
					
					const { username, userInfo, room } = {username: emailChat.split('@')[0], userInfo: userChat, room: roomChat};
					localStorage.setItem('email', this['email'].value);

					//Join chat room
					socket.emit('joinRoom', {username, userInfo, room});

					//Message from server
					socket.on('message', (message) => {
						const name = {username};

						outputMessage(message, name.username);

						//Scroll down
						chatMessages.scrollTop = chatMessages.scrollHeight;
					});

					chatForm.addEventListener('submit', (e) => {
						e.preventDefault();

						//Get message text
						const inputMessage = e.target.elements.msg;
						const msg = inputMessage.value;
						//Emit message to server
						socket.emit('chatMessage', msg);

						//Clear input
						inputMessage.value = '';
						inputMessage.focus();
					});

					//Send product in content chatapp
					let sendProducts = document.querySelectorAll('.send-product-js');
					for(let i = 0; i < sendProducts.length; i++){
						sendProducts[i].addEventListener('click', function(e){
							e.preventDefault();
							let srcImg = this.parentElement.previousElementSibling.firstElementChild.getAttribute('data-img');
							let contentLink = this.parentElement.previousElementSibling.firstElementChild.nextElementSibling.textContent;
							let priceDiscount = this.previousElementSibling.getAttribute('data-discount');
							let priceSpecial = this.previousElementSibling.getAttribute('data-special');
							let ele = '<p class="search__item mb-0 add-product">' 
												+ '<img width="40" class="search__img" src="'+srcImg+'" alt="">'
												+ '<a class="search__link" href="#">'+contentLink+'</a>'
												+ '<span class="search__price">'
													+ '<span class="search__price__discount">$'+priceDiscount+'</span><br/>'
													+ '<span class="search__price__special">$'+priceSpecial+'</span>'
												+ '</span>'
											+ '</p>';    							   
							socket.emit('chatMessage', ele);                  
						});
					}	
					//Confirm Your cart
					function confirmCartChatApp(){
						if(document.querySelector('.chatapp-confirm-js')) document.querySelector('.chatapp-confirm-js').addEventListener('click', function(e){
							e.preventDefault();
							let listProduct, content;
							listProduct = this.parentElement.parentElement.previousElementSibling.innerHTML;
							content = '<div class="chatapp__order__head">'
											+ '<h4 class="order__heading order__heading--confirm">Confirmed Cart</h4>'
										+ '</div>'
										+ '<div class="confirm-cart">'
											+ listProduct
										+ '</div>';
							socket.emit('chatMessage', content);          
						});
					}
					//Confirm Billing in ChatApp
					function confirmInformation(){
						if(document.querySelector('.chatapp-confirm-billing-js')) document.querySelector('.chatapp-confirm-billing-js').addEventListener('click', function(e){
							e.preventDefault();
							let informationBody, content;        
							informationBody = this.parentElement.parentElement.previousElementSibling.innerHTML;
							content = '<div class="chatapp__order__head confirm-shipping-billing">'
											+ '<h4 class="order__heading order__heading--confirm">Confirmed Information</h4>'
										+ '</div>'
										+ '<div class="chatapp__order__body chatapp__order__body--bill">'
											+ informationBody
										+ '</div>';
							socket.emit('chatMessage', content);							
						});
					}
					//Confirm Billing in ChatApp
					function confirmInShippingMethod(){
						if(document.querySelector('.chatapp-confirm-shipping-js')) document.querySelector('.chatapp-confirm-shipping-js').addEventListener('click', function(e){
							e.preventDefault();     
							let typeShippingMethod = document.getElementById("type-shipping-js");
							if(typeShippingMethod.value == ''){
								typeShippingMethod.nextElementSibling.classList.add('frm__error--block');
							}else{
								typeShippingMethod.nextElementSibling.classList.remove('frm__error--block');								
								let htmlBody = document.querySelector('.frm__shipping--active').innerHTML;
								let content = '<div class="chatapp__order__head confirm-shipping-method">'
													+ '<h4 class="order__heading order__heading--confirm">Confirmed Shipping Method</h4>'
												+ '</div>'
												+ '<div class="chatapp__order__body chatapp__order__body--bill">'
													+ '<h2 class="order__secondary">Shipping Method</h2>'
													+ '<div class="frm frm--checkout">'
														+ '<div class="frm__shipping shipping-js frm__shipping--active">'
															+ htmlBody
														+ '</div>'
													+ '</div>'
												+ '</div>';
								socket.emit('chatMessage', content);
							}   
						});
					}
					//Apply Coupon Chat App
					function applyCouponChatApp(){
						if(document.querySelector('.discount-group-js')) document.querySelector('.discount-group-js').addEventListener('keyup', function(){
							if(this.value !== '') this.nextElementSibling.classList.remove('frm__error--block');
						});
						if(document.querySelector('.chatapp-apply-coupon-js')) document.querySelector('.chatapp-apply-coupon-js').addEventListener('click', function(e){
							e.preventDefault();
							let coupon = document.querySelector('.discount-group-js');
							if(coupon.value === ''){
								coupon.nextElementSibling.classList.add('frm__error--block');
							}else{
								let result = discountCode.find(code => code.coupon === coupon.value);
								if(result === undefined){
									document.querySelector('.alert-checkout-js').style.display = 'block';
									setTimeout(function(){
										document.querySelector('.alert-checkout-js').style.display = 'none';
									}, 1000);
								}else{
									shoppingCart.couponToCart(result);
									let content = '<div class="chatapp__order__head apply-discount">'
														+ '<h4 class="order__heading order__heading--confirm">Applied</h4>'
													+ '</div>'
													+ '<div class="chatapp__order__body chatapp__order__body--coupon">'
														+ '<h2 class="order__secondary">Coupon Code</h2>'
														+ '<div class="chatapp__order__coupon">'
															+ '<span>'+result.coupon+' - '+result.persent+'% OFF</span>'
															+ '<span>- $'+shoppingCart.totalDiscount()+'</span>'
														+ '</div>'
													+ '</div>';
									socket.emit('chatMessage', content);
								}
							}
						});
					}
					//Confirm Order Summary
					function confirmOrderSummary(){
						if(document.querySelector('.chatapp-confirm-order-js')) document.querySelector('.chatapp-confirm-order-js').addEventListener('click', function(e){
							e.preventDefault();
							let htmlBody = this.parentElement.parentElement.previousElementSibling.innerHTML;							
							let content = '<div class="chatapp__order__head confirm-order-summary">'
													+ '<h4 class="order__heading order__heading--confirm">Confirmed Order Summary</h4>'
												+ '</div>'
												+ '<div class="chatapp__order__body chatapp__order__body--coupon chatapp__order--products">' + htmlBody + '</div>';
							socket.emit('chatMessage', content);
						});
					}
					//Output message to DOM
					function outputMessage(message, name, userInfo){    
						let isSentByCurrentUser = false;

						const trimmedName = name.trim().toLowerCase();

						if(message.username === trimmedName){
							isSentByCurrentUser = true;
						}

						const div = document.createElement('div');
						if(isSentByCurrentUser){
							if(isHTML(message.text)){ 
								if(message.text.includes("confirm-cart")){   
									div.innerHTML = `<div class="chatapp__box chatapp__box--customer chatapp__order chatapp__order--cart">${message.text}</div>`;
									document.querySelector('.chatapp-cart-close-js').remove();
								}else if(message.text.includes("shop-cart")){   
									div.innerHTML = '<div class="chatapp__box chatapp__box--customer chatapp__order chatapp__order--cart">'
															+ '<div class="chatapp__order__head">'
																+ '<h4 class="order__heading">Your cart</h4>'
															+ '</div>'
															+ '<div id="chatapp-body">'
																+ message.text
															+ '</div>'
														+ '</div>';
								}else if(message.text.includes("add-product")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--customer chatapp__box--product chatapp-customer-product"><span>${message.text}</span></div>`;
								}else if(message.text.includes("confirm-shipping-billing")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--customer chatapp__order">${message.text}</div>`;
									document.querySelector('.chatapp-billing-close-js').remove();
								}else if(message.text.includes("shipping-billing")){
									div.innerHTML = '<div class="chatapp__box chatapp__box--customer chatapp__order chatapp-change-info-js">'
														+ '<div class="chatapp__order__body chatapp__order__body--bill">'
															+ '<h2 class="order__secondary">Shipping and billing information</h2>'
															+ message.text
														+ '</div>'
														+  '<div class="chatapp__order__foot chatapp-billing-close-js">'
															+ '<div class="order__button">'
																+ '<a href="#" class="btn btn--green chatapp-confirm-billing-js">Confirm</a>'
																+ '<a href="chatapp/checkout-customer-shipping-billing.html" class="btn btn--grey chatapp-edit-js">Edit Info</a>'
															+ '</div>'
														+ '</div>'
													+'</div>';
								}else if(message.text.includes("confirm-shipping-method")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--customer chatapp__order">${message.text}</div>`;
									document.querySelector('.chatapp-shipping-method-js').remove();
								}else if(message.text.includes("shipping-method")){
									div.innerHTML = '<div class="chatapp__box chatapp__box--customer chatapp__order">'
														+ '<div class="chatapp__order__body chatapp__order__body--bill">'
															+ '<h2 class="order__secondary">Shipping Method</h2>'
															+ message.text                                           
														+ '</div>'
														+  '<div class="chatapp__order__foot chatapp-shipping-method-js">'
															+ '<div class="order__button">'
																+ '<a href="#" class="btn btn--green chatapp-confirm-shipping-js">Confirm</a>'
															+ '</div>'
														+ '</div>'
													+'</div>';
								}else if(message.text.includes("apply-discount")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--customer chatapp__order chatapp__order--coupon">${message.text}</div>`;
									document.querySelector('.chatapp-apply-discount-js').remove();
								}else if(message.text.includes('sales-coupon')){
									div.innerHTML = '<div class="chatapp__box chatapp__box--customer chatapp__order chatapp__order--coupon">'
															+ '<div class="chatapp__order__body chatapp__order__body--coupon">'
																+ message.text
															+ '</div>'
															+  '<div class="chatapp__order__foot chatapp-apply-discount-js">'
																+ '<div class="order__button">'
																	+ '<a href="#" class="btn btn--green chatapp-apply-coupon-js">Apply Discount</a>'
																+ '</div>'
															+ '</div>'
														+'</div>';									     
								}else if(message.text.includes("confirm-order-summary")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--customer chatapp__order chatapp__order--coupon">${message.text}</div>`;
									document.querySelector('.chatapp-order-summary-js').remove();
								}else if(message.text.includes('order-summary')){
									div.innerHTML = '<div class="chatapp__box chatapp__box--customer chatapp__order chatapp__order--coupon">'
															+ '<div class="chatapp__order__body chatapp__order__body--coupon chatapp__order--products">'
																+ '<h2 class="order__secondary">Order Summary</h2>'
																+ message.text                                           
															+ '</div>'
															+  '<div class="chatapp__order__foot chatapp-order-summary-js">'
																+ '<div class="order__button">'
																	+ '<a href="#" class="btn btn--green chatapp-confirm-order-js">Confirm</a>'
																+ '</div>'
															+ '</div>'
														+'</div>';									
								}else if(message.text.includes('payment-method')){
									div.innerHTML = '<div class="chatapp__box chatapp__box--customer chatapp__order chatapp__order--cart">'
														+ '<div class="chatapp__order__body chatapp__order__body--coupon">'
															+ '<h2 class="order__secondary">Payment Method</h2>'
															+ message.text
														+ '</div>'
														+  '<div class="chatapp__order__foot chatapp-select-hidden-js">'
															+ '<div class="order__button">'
																+ '<a href="chatapp/checkout-customer-payment.html" class="btn btn--green chatapp-edit-js">Select</a>'
															+ '</div>'
														+ '</div>'
													+'</div>';
								}else if(message.text.includes('waiting-customer')){
									div.innerHTML = `<p class="text-center chatapp__text chatapp-service">${message.text}</p>`;
								}else if(message.text.includes('please-oops')){
									div.innerHTML = `<p class="text-center chatapp__text chatapp-oops">${message.text}</p>`;
								}else if(message.text.includes('chat-now')){
									if(document.querySelector('.chatapp-service')) document.querySelector('.chatapp-service').parentElement.remove();
                					if(document.querySelector('.chatapp-oops')) document.querySelector('.chatapp-oops').parentElement.remove();
									document.querySelector('.panel__title').innerText = message.userInfo.fullname;
                					document.querySelector('.panel__name').innerText = message.userInfo.position;
									div.innerHTML = `<p class="text-center chatapp__text chatapp__text--sales chatapp-sales">${message.text}</p>`;
									setTimeout(function(){
										if(document.querySelector('.chatapp-sales')) document.querySelector('.chatapp-sales').parentElement.remove();
									}, 2000)
								}	
							}else{
								div.innerHTML = `<div class="chatapp__box chatapp__box--customer"><span>${message.text}</span></div>`;
							}
						}else{
							if(isHTML(message.text)){ 
								if(message.text.includes("confirm-cart")){   
									div.innerHTML = `<div class="chatapp__box chatapp__box--system chatapp__order chatapp__order--cart">${message.text}</div>`;		
									document.querySelector('.chatapp-cart-close-js').remove();						
								}else if(message.text.includes("shop-cart")){    
									div.innerHTML = '<div class="chatapp__box chatapp__box--system chatapp__order chatapp__order--cart">'
															+ '<div class="chatapp__order__head">'
																+ '<h4 class="order__heading">Your cart</h4>'
															+ '</div>'
															+ '<div id="chatapp-body">'
																+ message.text
															+ '</div>'
														+ '</div>';	
								}else if(message.text.includes("add-product")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--product chatapp__box--product-sales chatapp-customer-product"><span>${message.text}</span></div>`;
								}else if(message.text.includes("confirm-shipping-billing")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--system chatapp__order">${message.text}</div>`;
									document.querySelector('.chatapp-billing-close-js').remove();
								}else if(message.text.includes("shipping-billing")){
									div.innerHTML = '<div class="chatapp__box chatapp__box--system chatapp__order chatapp-change-info-js">'
														+ '<div class="chatapp__order__body chatapp__order__body--bill">'
															+ '<h2 class="order__secondary">Shipping and billing information</h2>'
															+ message.text
														+ '</div>'
														+  '<div class="chatapp__order__foot chatapp-billing-close-js">'
															+ '<div class="order__button">'
																+ '<a href="#" class="btn btn--green chatapp-confirm-billing-js">Confirm</a>'
																+ '<a href="chatapp/checkout-customer-shipping-billing.html" class="btn btn--grey chatapp-edit-js">Edit Info</a>'
															+ '</div>'
														+ '</div>'
													+'</div>';
								}else if(message.text.includes("confirm-shipping-method")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--system chatapp__order">${message.text}</div>`;
									document.querySelector('.chatapp-shipping-method-js').remove();
								}else if(message.text.includes("shipping-method")){
									div.innerHTML = '<div class="chatapp__box chatapp__box--system chatapp__order">'
														+ '<div class="chatapp__order__body chatapp__order__body--bill">'
															+ '<h2 class="order__secondary">Shipping Method</h2>'
															+ message.text
														+ '</div>'
														+  '<div class="chatapp__order__foot chatapp-shipping-method-js">'
															+ '<div class="order__button">'
																+ '<a href="#" class="btn btn--green chatapp-confirm-shipping-js">Confirm</a>'
															+ '</div>'
														+ '</div>'
													+'</div>';
								}else if(message.text.includes("apply-discount")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--system chatapp__order chatapp__order--coupon">${message.text}</div>`;
									document.querySelector('.chatapp-apply-discount-js').remove();
								}else if(message.text.includes('sales-coupon')){
									div.innerHTML = '<div class="chatapp__box chatapp__box--system chatapp__order chatapp__order--coupon">'
															+ '<div class="chatapp__order__body chatapp__order__body--coupon">'
																+ message.text
															+ '</div>'
															+  '<div class="chatapp__order__foot chatapp-apply-discount-js">'
																+ '<div class="order__button">'
																	+ '<a href="#" class="btn btn--green chatapp-apply-coupon-js">Apply Discount</a>'
																+ '</div>'
															+ '</div>'
														+'</div>';   
								}else if(message.text.includes("confirm-order-summary")){
									div.innerHTML = `<div class="chatapp__box chatapp__box--system chatapp__order chatapp__order--coupon">${message.text}</div>`;
									document.querySelector('.chatapp-order-summary-js').remove();
								}else if(message.text.includes('order-summary')){
									div.innerHTML = '<div class="chatapp__box chatapp__box--system chatapp__order chatapp__order--coupon">'
															+ '<div class="chatapp__order__body chatapp__order__body--coupon chatapp__order--products">'
																+ '<h2 class="order__secondary">Order Summary</h2>'
																+ message.text                                           
															+ '</div>'
															+  '<div class="chatapp__order__foot chatapp-order-summary-js">'
																+ '<div class="order__button">'
																	+ '<a href="#" class="btn btn--green chatapp-confirm-order-js">Confirm</a>'
																+ '</div>'
															+ '</div>'
														+'</div>';									
								}else if(message.text.includes('payment-method')){
									div.innerHTML = '<div class="chatapp__box chatapp__box--system chatapp__order chatapp__order--cart">'
														+ '<div class="chatapp__order__body chatapp__order__body--coupon">'
															+ '<h2 class="order__secondary">Payment Method</h2>'
															+ message.text
														+ '</div>'
														+  '<div class="chatapp__order__foot chatapp-select-hidden-js">'
															+ '<div class="order__button">'
																+ '<a href="chatapp/checkout-customer-payment.html" class="btn btn--green chatapp-edit-js">Select</a>'
															+ '</div>'
														+ '</div>'
													+'</div>';
								}else if(message.text.includes('waiting-customer')){
									div.innerHTML = `<p class="text-center chatapp__text chatapp-service">${message.text}</p>`;
								}else if(message.text.includes('please-oops')){
									div.innerHTML = `<p class="text-center chatapp__text chatapp-oops">${message.text}</p>`;
								}else if(message.text.includes('chat-now')){
									if(document.querySelector('.chatapp-service')) document.querySelector('.chatapp-service').parentElement.remove();
                					if(document.querySelector('.chatapp-oops')) document.querySelector('.chatapp-oops').parentElement.remove();
									document.querySelector('.panel__title').innerText = message.userInfo.fullname;
                					document.querySelector('.panel__name').innerText = message.userInfo.position;
									div.innerHTML = `<p class="text-center chatapp__text chatapp__text--sales chatapp-sales">${message.text}</p>`;
									setTimeout(function(){
										if(document.querySelector('.chatapp-sales')) document.querySelector('.chatapp-sales').parentElement.remove();
									}, 2000)
								}
							}else{
								div.innerHTML = `<div class="chatapp__box chatapp__box--system chatapp-thank"><span>${message.text}</span></div>`;
							}
						}
						document.querySelector('.chatapp-content-js').appendChild(div);    
						openEditConfirm();
						confirmCartChatApp();
						confirmInformation();
						activeShippingMethod();
						confirmInShippingMethod();
						applyCouponChatApp();
						confirmOrderSummary();
					}
				}
			});
			//Validate form input
			function validate(form){
				let email = form['email'];
				let room = form['room'];
				if(email.value === ''){
					email.focus();
					return false;
				}
				if(room.value === ''){
					email.focus();
					return false;
				}
				return true;
			}
			//Check html
			function isHTML(str) {
				var doc = new DOMParser().parseFromString(str, "text/html");
				return Array.from(doc.body.childNodes).some(node => node.nodeType === 1);
			}
			//Search product
			document.querySelector('.active-search-js').addEventListener('click', function(e){
				e.stopPropagation();
				this.firstElementChild.classList.add('chatapp__form--active');
				searchProduct();
			});
			let html = '';
			for(let i in chatappProducts){
				html += '<li class="search__item search__radius">'
						+ '<div class="search__item__col">'
							+ '<img width="40" data-img="'+chatappProducts[i].image +'" class="search__img" src="'+chatappProducts[i].image+'" alt="">'
							+ '<a class="search__link" href="#">'+chatappProducts[i].name+'</a>'
						+ '</div>'
						+ '<div class="search__item__col">'
							+ '<span class="search__price" data-discount="'+chatappProducts[i].price_discount+'" data-special="'+chatappProducts[i].price+'">'
								+ '<span class="search__price__discount">$'+chatappProducts[i].price_discount+'</span><br/>'
								+ '<span class="search__price__special">$'+chatappProducts[i].price+'</span>'
							+ '</span>'
							+ '<button class="btn__send send-product-js">Send</button>'
						+ '</div>'
					+ '</li>';
			}
			let listProduct = document.createElement('div');         
			listProduct.innerHTML = '<ul id="autocomplete-products-js" class="search__list" style="display: none;">'+html+'</ul>';
			document.querySelector('.search-list-js').appendChild(listProduct);
			function searchProduct() {
				document.getElementById('search-product').addEventListener('keyup', function(e){
					var filter, ul, li, a, i, txtValue;               
					filter = this.value.toUpperCase();
					ul = document.getElementById("autocomplete-products-js");
					if(filter !== ''){
						ul.style.display = 'block';
					}else{
						ul.style.display = 'none';
					}
					li = ul.getElementsByTagName("li");
					for (i = 0; i < li.length; i++) {
						a = li[i].getElementsByTagName("a")[0];
						txtValue = a.textContent || a.innerText;
						if (txtValue.toUpperCase().indexOf(filter) > -1) {
							li[i].style.display = "";
						} else {
							li[i].style.display = "none";
						}
					}
				});
			}
			//Edit Cart Info
			function openEditConfirm(){
				let popup;
				let openWebConfirm = document.querySelectorAll('.chatapp-edit-js');
				for(let i = 0; i < openWebConfirm.length; i++){
					openWebConfirm[i].addEventListener('click', function(e){
						e.preventDefault();
						popup = window.open(this.href, "Popup", "toolbar=yes,scrollbars=yes,resizable=yes,top=100,left=250,width=1023,height=650");
						return false;
					});
				}
			}
			/*Active shipping*/
			function activeShippingMethod(){
				let activeShipping = document.querySelectorAll('.shipping-js');
				for (var i = 0; i < activeShipping.length; i++) {
					activeShipping[i].onclick = function (event) {
						event.preventDefault();
						for (var i = 0; i < activeShipping.length; i++) {
							activeShipping[i].classList.remove('frm__shipping--active');
						}
						this.classList.add("frm__shipping--active");
						document.getElementById("type-shipping-js").nextElementSibling.classList.remove('frm__error--block');
						let shippingMethod = this.getAttribute('data-shipping-method');                
						document.getElementById("type-shipping-js").setAttribute('value', shippingMethod);
						localStorage.setItem('shipping-method', shippingMethod);
					}
				}
			}
			function receivedPopup(data){
				socket.emit('chatMessage', data);
			}
			//Toggle Cart Detail
            function toggleCartDetail(){
                let toggleEl = document.querySelectorAll('.toggle-chatapp-cart-js');
                for(i = 0; i < toggleEl.length; i++){
                    toggleEl[i].addEventListener('click', function(){
                        this.classList.toggle('order__coupon__title--checkout');
                        this.nextElementSibling.classList.toggle('products-active');
                    });
                }
            }
            //Close ChatApp
            document.querySelector('.chatapp-session-js').addEventListener('click', function(){   
                document.querySelector('.chatapp-logo').classList.remove('chatapp-hidden');
                document.querySelector('.chatapp-form').parentElement.classList.add('panel__body--login');
                document.querySelector('.chatapp-form').classList.remove('chatapp-hidden');    
                document.querySelector('.panel').classList.remove('panel--system');
                document.querySelector('.chatapp-system').classList.add('chatapp-visible');                    
                document.querySelector('.chatapp-message-js').firstElementChild.setAttribute('readonly','readonly');
                document.querySelector('.chatapp-message-js').firstElementChild.nextElementSibling.setAttribute('disabled','disabled');
                document.querySelector('.file').setAttribute('disabled','disabled');
                document.querySelector('.footer-active-js').firstElementChild.nextElementSibling.classList.remove('search-product-js');
                document.querySelector('.chatapp-content-js').innerHTML = '';
                document.querySelector('.panel').classList.remove('panel-active');
                document.querySelector('.chatapp__icon').classList.remove('chatapp-hidden');
                document.querySelector('.panel__title').innerText = "";
                document.querySelector('.panel__name').innerText = "";
                window.location = '';
                localStorage.removeItem('email');
            });
		</script>
	</body>
</html>
